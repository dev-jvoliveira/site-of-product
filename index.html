<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EASYSHOP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0b0c10;
        --card: #111218;
        --text: #e6e7eb;
        --muted: #a7abb4;
        --brand: #f00050;
        --brand-2: #ff4d8a;
        --border: #1f2230;
        --ring: rgba(240, 0, 80, 0.35);
        --ok: #22c55e;
        --warn: #f59e0b;
        --hero-bg: #000;
      }
      :root.light {
        --bg: #f7f7fb;
        --card: #ffffff;
        --text: #1f2937;
        --muted: #6b7280;
        --brand: #f00050;
        --brand-2: #ff7aa7;
        --border: #e5e7eb;
        --ring: rgba(240, 0, 80, 0.25);
        --ok: #16a34a;
        --warn: #d97706;
        --hero-bg: #ffffff;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto,
          sans-serif;
        background: radial-gradient(
            1200px 800px at 10% -10%,
            rgba(124, 58, 237, 0.2),
            transparent 60%
          ),
          radial-gradient(
            1000px 700px at 110% -20%,
            rgba(110, 231, 249, 0.15),
            transparent 60%
          ),
          var(--bg);
        color: var(--text);
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      .container {
        width: min(1100px, 92%);
        margin: 0 auto;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 50;
        backdrop-filter: saturate(1.2) blur(10px);
        background: color-mix(in srgb, var(--bg) 70%, transparent);
        border-bottom: 1px solid var(--border);
      }
      .nav {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 14px 0;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .logo-badge {
        width: auto;
        height: 36px;
        border-radius: 6px;
        background: none;
        box-shadow: none;
        display: flex;
        align-items: center;
      }
      .logo-badge img {
        height: 36px;
        width: auto;
        display: block;
      }
      .nav-links {
        display: flex;
        gap: 14px;
        margin-left: 10px;
      }
      .nav-links a {
        padding: 8px 12px;
        border-radius: 10px;
        color: var(--muted);
      }
      .nav-links a:hover {
        color: var(--text);
        background: color-mix(in srgb, var(--card) 90%, transparent);
      }
      .search {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 10px;
      }
      .search input {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--text);
        outline: none;
      }
      .search input:focus {
        box-shadow: 0 0 0 6px var(--ring);
        border-color: color-mix(in srgb, var(--brand) 40%, var(--border));
      }
      .actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .btn {
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
      }
      .btn:hover {
        border-color: color-mix(in srgb, var(--brand) 35%, var(--border));
      }
      .btn.primary {
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        border-color: transparent;
        color: #fff;
        font-weight: 600;
      }
      .hero {
        position: relative;
        overflow: hidden;
        border-bottom: 1px solid var(--border);
      }
      .hero-inner {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 40px;
        padding: 48px 0;
        align-items: center;
      }
      .hero h1 {
        font-size: clamp(28px, 4vw, 44px);
        line-height: 1.05;
        margin: 0 0 12px;
      }
      .hero p {
        color: var(--muted);
        margin: 0 0 18px;
      }
      .hero-cta {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .hero-card {
        background: linear-gradient(
          180deg,
          color-mix(in srgb, var(--card) 85%, transparent),
          var(--card)
        );
        border: 1px solid var(--border);
        padding: 10px;
        border-radius: 19px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      .hero-img {
        aspect-ratio: 5.2/3;
        background: var(--hero-bg);
        border-radius: 16px;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .hero-img img {
        max-width: 100%;
        height: auto;
        display: block;
        object-fit: contain;
      }
      .filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin: 28px 0 10px;
      }
      .select,
      .range {
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--text);
        border-radius: 12px;
        padding: 10px 12px;
      }
      .range {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .range input {
        accent-color: var(--brand);
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 16px;
      }
      .card {
        grid-column: span 4;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
      }
      .thumb {
        aspect-ratio: 4/3;
        background: linear-gradient(135deg, #0a0f1f, #101631);
        display: grid;
        place-items: center;
        color: #c2e9ff;
        font-weight: 600;
        border-bottom: 1px solid var(--border);
      }
      .body {
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .title {
        font-weight: 600;
      }
      .price {
        font-weight: 700;
      }
      .meta {
        color: var(--muted);
        font-size: 14px;
      }
      .chip {
        font-size: 12px;
        padding: 4px 8px;
        border: 1px solid var(--border);
        border-radius: 999px;
        color: var(--muted);
      }
      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }
      footer {
        border-top: 1px solid var(--border);
        margin-top: 48px;
        background: color-mix(in srgb, var(--bg) 80%, transparent);
      }
      .footer-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1.2fr;
        gap: 24px;
        padding: 28px 0;
      }
      .foot-title {
        font-weight: 600;
        margin-bottom: 10px;
      }
      .foot a {
        color: var(--muted);
        display: block;
        padding: 6px 0;
      }
      .foot a:hover {
        color: var(--text);
      }
      .credits {
        border-top: 1px solid var(--border);
        padding: 14px 0;
        color: var(--muted);
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .drawer {
        position: fixed;
        inset: 0 0 0 auto;
        width: 380px;
        background: var(--card);
        border-left: 1px solid var(--border);
        transform: translateX(110%);
        transition: transform 0.25s ease;
        display: flex;
        flex-direction: column;
        z-index: 60;
      }
      .drawer.open {
        transform: translateX(0);
      }
      .drawer-header {
        padding: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
      }
      .drawer-list {
        padding: 10px 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        overflow: auto;
      }
      .drawer-item {
        display: grid;
        grid-template-columns: 56px 1fr auto;
        gap: 12px;
        align-items: center;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 8px;
        background: color-mix(in srgb, var(--card) 90%, transparent);
      }
      .drawer-footer {
        margin-top: auto;
        border-top: 1px solid var(--border);
        padding: 16px;
        display: grid;
        gap: 10px;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        color: var(--muted);
      }
      .badge .dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--ok);
      }
      .whatsapp-float {
        position: fixed;
        right: 18px;
        bottom: 18px;
        height: 56px;
        padding: 0 14px 0 12px;
        border-radius: 999px;
        background: #25d366;
        color: #fff;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        border: 1px solid color-mix(in srgb, #000 10%, transparent);
        z-index: 70;
        transition: transform 0.15s ease, box-shadow 0.15s ease, right 0.2s ease;
        text-decoration: none;
        font-weight: 600;
      }
      .whatsapp-float:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.28);
      }
      .whatsapp-float img {
        width: 24px;
        height: 24px;
        display: block;
      }
      .whatsapp-float .wa-label {
        line-height: 1;
        white-space: nowrap;
      }
      .drawer.open + .whatsapp-float {
        right: 410px;
      }
      @media (max-width: 640px) {
        .drawer.open + .whatsapp-float {
          right: 18px;
        }
      }
      @media (max-width: 420px) {
        .whatsapp-float {
          padding: 0 12px;
        }
        .whatsapp-float .wa-label {
          display: none;
        }
      }

      /* ADMIN */
      #admin[hidden] {
        display: none;
      }
      .admin-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 16px;
      }
      .admin-card {
        grid-column: span 6;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px;
      }
      .admin-form {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 12px;
      }
      .admin-form .field {
        grid-column: span 6;
        display: grid;
        gap: 6px;
      }
      .admin-form input,
      .admin-form select {
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--text);
        border-radius: 10px;
        padding: 10px;
      }
      .admin-bar {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin: 12px 0;
      }
      .note {
        color: var(--muted);
        font-size: 13px;
      }

      .thumb {
        position: relative;
        overflow: hidden;
      }
      .thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      @media (max-width: 980px) {
        .hero-inner {
          grid-template-columns: 1fr;
        }
        .grid .card {
          grid-column: span 6;
        }
        .footer-grid {
          grid-template-columns: 1fr 1fr;
        }
        .admin-card {
          grid-column: span 12;
        }
      }
      @media (max-width: 640px) {
        .nav {
          flex-wrap: wrap;
          gap: 10px;
        }
        .search {
          order: 3;
          width: 100%;
          margin-left: 0;
        }
        .grid .card {
          grid-column: span 12;
        }
        .drawer {
          width: 100%;
        }
        .admin-form .field {
          grid-column: span 12;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container nav">
        <div class="logo" aria-label="EASYSHOP">
          <div class="logo-badge" aria-hidden="true">
            <img src="images/LOGO-EASYSHOP (PNG).png" alt="EASYSHOP logo" />
          </div>
          <span>EASYSHOP</span>
        </div>
        <nav class="nav-links" aria-label="Primary navigation">
          <a href="#produtos">Products</a>
          <a href="#novidades">News</a>
          <a href="#sobre">About us</a>
          <a href="#contato">Contact us</a>
          <a href="#admin" id="adminLink">Admin</a>
        </nav>
        <div class="search" role="search">
          <input
            id="q"
            type="search"
            placeholder="Search products..."
            aria-label="Search products"
          />
        </div>
        <div class="actions">
          <button class="btn" id="themeBtn" aria-label="Toggle theme">
            ðŸŒ“
          </button>
          <button class="btn" id="cartBtn" aria-label="Open cart">
            ðŸ›’
            <span id="cartCount" class="chip" style="margin-left: 6px">0</span>
          </button>
          <button class="btn" id="loginBtn" aria-label="Admin login">
            Login
          </button>
          <button
            class="btn"
            id="logoutBtn"
            aria-label="Admin logout"
            style="display: none"
          >
            Logout
          </button>
          <a class="btn primary" href="#produtos">Shop</a>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="container hero-inner">
        <div class="hero-card">
          <div class="badge" style="margin-bottom: 8px">
            <span class="dot"></span> Business hours: Monâ€“Fri, 8 AMâ€“5 PM (GMT-3)
          </div>
          <h1>
            Discover products with
            <span style="color: var(--brand)">modern design</span> and
            <span style="color: var(--brand-2)">premium quality</span>.
          </h1>
          <p>
            A curated selection with fast delivery, warranty, and human support.
            Filter by category, price range, and add to cart with one click.
          </p>
          <div class="hero-cta">
            <a class="btn primary" href="#produtos">View catalog</a>
            <a class="btn" href="#sobre">More info</a>
          </div>
        </div>
        <div class="hero-img">
          <img src="images/PEQUENO.png" alt="Hero banner" />
        </div>
      </div>
    </section>

    <main class="container" id="produtos" style="padding: 22px 0 0">
      <div class="filters" aria-label="Product filters">
        <select id="cat" class="select" aria-label="Category">
          <option value="">All categories</option>
          <option>Electronics</option>
          <option>Home & Kitchen</option>
          <option>Sports</option>
        </select>
        <div class="range" aria-label="Max price">
          <label for="maxPrice">Up to $</label>
          <input id="maxPrice" type="range" min="50" max="2000" value="2000" />
          <span id="maxPriceValue">2000</span>
        </div>
        <span class="chip" id="resultCount">0 results</span>
      </div>
      <section
        class="grid"
        id="grid"
        aria-live="polite"
        aria-busy="false"
      ></section>
    </main>

    <!-- Admin -->
    <section class="container" id="admin" hidden style="padding: 22px 0">
      <h2 style="margin: 0 0 12px">Admin</h2>
      <div id="adminLoggedOut" class="admin-card">
        <strong>Sign in</strong>
        <div class="admin-form" style="margin-top: 10px">
          <div class="field" style="grid-column: span 6">
            <label for="admEmail" class="meta">Email</label>
            <input id="admEmail" type="email" placeholder="admin@email.com" />
          </div>
          <div class="field" style="grid-column: span 6">
            <label for="admPass" class="meta">Password</label>
            <input id="admPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          </div>
          <div class="field" style="grid-column: span 12">
            <button class="btn primary" id="doLogin">Sign in</button>
          </div>
          <div class="note" style="grid-column: span 12">
            Only admins can add/remove/mark products as sold.
          </div>
        </div>
      </div>

      <div id="adminLoggedIn" style="display: none">
        <div class="admin-card">
          <strong>Add product</strong>
          <form id="adminAddForm" class="admin-form" style="margin-top: 10px">
            <div class="field" style="grid-column: span 12">
              <label class="meta" for="pimgFile">Image (upload)</label>
              <input id="pimgFile" type="file" accept="image/*" />
              <small class="meta">Or paste an image URL below (optional)</small>
              <input id="pimg" placeholder="https://example.com/image.jpg" />
            </div>
            <div class="field">
              <label class="meta" for="pcat">Category</label>
              <select id="pcat" required>
                <option>Electronics</option>
                <option>Home & Kitchen</option>
                <option>Sports</option>
              </select>
            </div>
            <div class="field">
              <label class="meta" for="pprice">Price (USD)</label
              ><input
                id="pprice"
                type="number"
                step="0.01"
                min="0"
                required
                placeholder="199.99"
              />
            </div>
            <div class="field">
              <label class="meta" for="prating">Rating (1-5)</label
              ><input
                id="prating"
                type="number"
                step="0.1"
                min="1"
                max="5"
                placeholder="4.7"
              />
            </div>
            <div class="field" style="grid-column: span 12">
              <label class="meta" for="pimg">Image label (optional)</label
              ><input
                id="pimg"
                placeholder="e.g. HEADPHONES or image URL soon"
              />
            </div>
            <div class="field" style="grid-column: span 12">
              <button class="btn primary" type="submit">Add</button>
            </div>
          </form>
          <div class="note">
            Tip: Images are placeholders (text). Later we can store URLs.
          </div>
        </div>

        <div class="admin-bar">
          <button class="btn" id="restoreAll">Restore all</button>
          <span class="chip">Sold out: <strong id="soldCount">0</strong></span>
        </div>

        <section class="admin-grid" id="adminList" aria-live="polite"></section>
      </div>
    </section>

    <footer id="contato">
      <div class="container footer-grid foot">
        <div>
          <div class="foot-title">About EASYSHOP</div>
          <p style="color: var(--muted); margin: 0">
            Weâ€™re passionate about well-made products. Fast shipping, friendly
            support, and a 1-year warranty storewide.
          </p>
        </div>
        <div>
          <div class="foot-title">Categories</div>
          <a href="#produtos" data-cat="Electronics" class="foot-link"
            >Electronics</a
          >
          <a href="#produtos" data-cat="Home & Kitchen" class="foot-link"
            >Home & Kitchen</a
          >
          <a href="#produtos" data-cat="Sports" class="foot-link">Sports</a>
        </div>
        <div>
          <div class="foot-title">Help</div>
          <a href="#">Shipping</a>
          <a href="#">Returns & Refunds</a>
          <a href="#">Warranty</a>
        </div>
        <div>
          <div class="foot-title">Subscribe for updates</div>
          <form id="newsForm">
            <div style="display: flex; gap: 8px">
              <input
                type="email"
                required
                placeholder="your@email.com"
                class="select"
                style="flex: 1"
                aria-label="Email"
              />
              <button class="btn primary" type="submit">Subscribe</button>
            </div>
            <small id="newsMsg" style="color: var(--muted)"></small>
          </form>
        </div>
      </div>
      <div class="container credits">
        <span>Â© <span id="year"></span> EASYSHOP</span>
        <span>Made with â™¥</span>
      </div>
    </footer>

    <aside
      class="drawer"
      id="drawer"
      aria-hidden="true"
      aria-label="Shopping cart"
    >
      <div class="drawer-header">
        <strong>Your cart</strong
        ><button class="btn" id="closeDrawer" aria-label="Close">âœ•</button>
      </div>
      <div class="drawer-list" id="cartList"></div>
      <div class="drawer-footer">
        <div class="row">
          <span>Subtotal</span><strong id="subtotal">$ 0.00</strong>
        </div>
        <button class="btn primary" id="checkout">Checkout</button>
      </div>
    </aside>

    <a
      class="whatsapp-float"
      href="https://wa.me/5519991578587?text=Hello%20EASYSHOP%2C%20I%20came%20from%20the%20website."
      target="_blank"
      rel="noopener"
      aria-label="Contact us on WhatsApp"
      title="WhatsApp"
    >
      <img src="images/whatsapp (1).png" alt="" /><span class="wa-label"
        >Contact us!</span
      >
    </a>

    <script type="module">
      // ================= Firebase (replace with your config!) =================
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signInWithEmailAndPassword,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
      import {
        getFirestore,
        collection,
        onSnapshot,
        addDoc,
        updateDoc,
        deleteDoc,
        doc,
        serverTimestamp,
        query,
        orderBy,
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDkhNlOQliVO_iuhiH4qsNvaqHP0Umrv1I",
        authDomain: "easyshop-products.firebaseapp.com",
        projectId: "easyshop-products",
      };
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // ================= State & Utils =================
      const state = {
        q: "",
        cat: "",
        maxPrice: 2000,
        cart: [],
        theme: localStorage.getItem("theme") || "dark",
        products: [], // Firestore products
      };
      const fmt = (v) =>
        v.toLocaleString("en-US", { style: "currency", currency: "USD" });

      function applyTheme() {
        if (state.theme === "light")
          document.documentElement.classList.add("light");
        else document.documentElement.classList.remove("light");
        localStorage.setItem("theme", state.theme);
      }

      // ================= Catalog Rendering =================
      function renderProdutos() {
        const grid = document.getElementById("grid");
        grid.setAttribute("aria-busy", "true");
        const list = (state.products || []).filter((p) => p.active !== false);
        const filtered = list.filter((p) => {
          const name = (p.nome || "").toLowerCase();
          const matchQ = state.q === "" || name.includes(state.q);
          const matchCat = !state.cat || p.cat === state.cat;
          const matchPrice = Number(p.preco || 0) <= state.maxPrice;
          return matchQ && matchCat && matchPrice;
        });
        document.getElementById("resultCount").textContent = `${
          filtered.length
        } result${filtered.length !== 1 ? "s" : ""}`;
        grid.innerHTML = filtered
          .map((p) => {
            const hasUrl =
              typeof p.img === "string" && p.img.startsWith("http");
            return `
    <article class="card" data-id="${p.id}">
      <div class="thumb">
        ${
          hasUrl
            ? `<img src="${p.img}" alt="${p.nome || "Product"}" loading="lazy">`
            : `${p.img || "IMG"}`
        }
      </div>
      <div class="body">
        <div class="title">${p.nome || ""}</div>
        <div class="row"><span class="meta">${p.cat || ""}</span>
          <span class="chip">â˜… ${Number(p.rating || 4.5).toFixed(1)}</span>
        </div>
        <div class="row">
          <div class="price">${fmt(Number(p.preco || 0))}</div>
          <button class="btn" data-add="${p.id}">Add</button>
        </div>
      </div>
    </article>`;
          })
          .join("");
      }

      // ================= Cart =================
      function renderCart() {
        const list = document.getElementById("cartList");
        if (state.cart.length === 0) {
          list.innerHTML =
            '<div style="color:var(--muted)">Your cart is empty.</div>';
          document.getElementById("subtotal").textContent = fmt(0);
          document.getElementById("cartCount").textContent = "0";
          return;
        }
        let subtotal = 0;
        list.innerHTML = state.cart
          .map((item) => {
            const p = state.products.find((x) => x.id === item.id);
            if (!p) return "";
            const price = Number(p.preco || 0);
            const total = price * item.qty;
            subtotal += total;
            return `<div class="drawer-item">
            <div style="width:56px;height:42px;border:1px solid var(--border);border-radius:8px;display:grid;place-items:center;color:#c2e9ff;background:linear-gradient(135deg,#0a0f1f,#101631)">${
              p.img || "IMG"
            }</div>
            <div><div style="font-weight:600">${p.nome || ""}</div>
            <div class="meta">${fmt(
              price
            )} Â· Qty: <button class="btn" data-dec="${
              p.id
            }" aria-label="Decrease">âˆ’</button> ${
              item.qty
            } <button class="btn" data-inc="${
              p.id
            }" aria-label="Increase">+</button></div></div>
            <strong>${fmt(total)}</strong></div>`;
          })
          .join("");
        document.getElementById("subtotal").textContent = fmt(subtotal);
        const count = state.cart.reduce((a, b) => a + b.qty, 0);
        document.getElementById("cartCount").textContent = String(count);
      }
      function addToCart(id) {
        const item = state.cart.find((i) => i.id === id);
        if (item) item.qty += 1;
        else state.cart.push({ id, qty: 1 });
        renderCart();
      }
      function changeQty(id, delta) {
        const idx = state.cart.findIndex((i) => i.id === id);
        if (idx === -1) return;
        state.cart[idx].qty += delta;
        if (state.cart[idx].qty <= 0) state.cart.splice(idx, 1);
        renderCart();
      }

      // ================= Drawer =================
      function openDrawer() {
        const d = document.getElementById("drawer");
        d.classList.add("open");
        d.setAttribute("aria-hidden", "false");
      }
      function closeDrawer() {
        const d = document.getElementById("drawer");
        d.classList.remove("open");
        d.setAttribute("aria-hidden", "true");
      }

      // ================= Admin UI =================
      function saveSoldCount() {
        const sold = state.products.filter((p) => p.active === false).length;
        const el = document.getElementById("soldCount");
        if (el) el.textContent = sold;
      }
      function renderAdmin() {
        saveSoldCount();
        const wrap = document.getElementById("adminList");
        if (!wrap) return;
        wrap.innerHTML = (state.products || [])
          .map((p) => {
            const isSold = p.active === false;
            return `<article class="admin-card">
            <div class="title">${p.nome || ""}</div>
            <div class="row"><span class="meta">${p.cat || ""} Â· ${fmt(
              Number(p.preco || 0)
            )}</span><span class="chip">${
              isSold ? "SOLD OUT" : "ACTIVE"
            }</span></div>
            <div class="row" style="margin-top:6px;">
              <button class="btn ${
                isSold ? "primary" : ""
              }" data-toggle-sold="${p.id}">${
              isSold ? "Restore" : "Mark as sold"
            }</button>
              <button class="btn" data-delete="${p.id}">Delete</button>
            </div>
          </article>`;
          })
          .join("");
      }
      function route() {
        const isAdmin = location.hash === "#admin";
        const adminSec = document.getElementById("admin");
        const hero = document.querySelector(".hero");
        const main = document.querySelector("main.container");
        adminSec.hidden = !isAdmin;
        if (hero) hero.style.display = isAdmin ? "none" : "";
        if (main) main.style.display = isAdmin ? "none" : "";
        if (isAdmin) renderAdmin();
      }
      window.addEventListener("hashchange", route);

      // ================= Firestore Live Query =================
      const productsCol = collection(db, "products");
      const q = query(productsCol, orderBy("createdAt", "desc"));
      onSnapshot(q, (snap) => {
        state.products = snap.docs.map((d) => ({ id: d.id, ...d.data() }));
        renderProdutos();
        if (location.hash === "#admin") renderAdmin();
      });

      // ================= Admin Actions (Firestore) =================
      async function addProduct(data) {
        await addDoc(productsCol, {
          nome: data.nome,
          cat: data.cat,
          preco: Number(data.preco),
          rating: Number(data.rating) || 4.5,
          img: data.img || "IMG",
          active: true,
          createdAt: serverTimestamp(),
        });
      }

      async function markSold(id) {
        await updateDoc(doc(db, "products", id), {
          active: false,
          updatedAt: serverTimestamp(),
        });
      }

      async function restoreProduct(id) {
        await updateDoc(doc(db, "products", id), {
          active: true,
          updatedAt: serverTimestamp(),
        });
      }

      async function removeProduct(id) {
        await deleteDoc(doc(db, "products", id));
      }

      // === Admin: envio do formulÃ¡rio "Add product" ===
      const adminAddForm = document.getElementById("adminAddForm");
      if (adminAddForm) {
        adminAddForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = {
            nome: document.getElementById("pname").value.trim(),
            cat: document.getElementById("pcat").value,
            preco: document.getElementById("pprice").value.trim(),
            rating: document.getElementById("prating").value.trim(),
            img: document.getElementById("pimg").value.trim(),
          };
          if (!data.nome || !data.cat || data.preco === "") {
            alert("Fill in Name, Category and Price.");
            return;
          }
          try {
            const btn = adminAddForm.querySelector('button[type="submit"]');
            if (btn) {
              btn.disabled = true;
              btn.textContent = "Adding...";
            }
            await addProduct(data);
            adminAddForm.reset();
            alert("Product added!");
          } catch (err) {
            console.error(err);
            alert("Failed to add product: " + (err.message || err));
          } finally {
            const btn = adminAddForm.querySelector('button[type="submit"]');
            if (btn) {
              btn.disabled = false;
              btn.textContent = "Add";
            }
          }
        });
      }

      // ================= Auth =================
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const adminLoggedOut = document.getElementById("adminLoggedOut");
      const adminLoggedIn = document.getElementById("adminLoggedIn");
      const doLoginBtn = document.getElementById("doLogin");

      loginBtn.addEventListener("click", () => {
        location.hash = "#admin";
        document.getElementById("admEmail").focus();
      });
      logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
        alert("Logged out!");
      });
      doLoginBtn.addEventListener("click", async () => {
        const email = document.getElementById("admEmail").value.trim();
        const pass = document.getElementById("admPass").value.trim();
        if (!email || !pass) return alert("Enter email and password.");
        try {
          await signInWithEmailAndPassword(auth, email, pass);
        } catch (err) {
          alert(err.message);
        }
      });

      onAuthStateChanged(auth, (user) => {
        const isInAdmin = location.hash === "#admin";
        loginBtn.style.display = user ? "none" : "inline-flex";
        logoutBtn.style.display = user ? "inline-flex" : "none";
        if (adminLoggedOut)
          adminLoggedOut.style.display = user ? "none" : "block";
        if (adminLoggedIn)
          adminLoggedIn.style.display = user ? "block" : "none";
        if (isInAdmin) renderAdmin();
      });

      // ================= Events (catalog + admin) =================
      document.addEventListener("click", (e) => {
        const add = e.target.closest("[data-add]");
        if (add) {
          addToCart(add.dataset.add);
        }
        const inc = e.target.closest("[data-inc]");
        if (inc) {
          changeQty(inc.dataset.inc, +1);
        }
        const dec = e.target.closest("[data-dec]");
        if (dec) {
          changeQty(dec.dataset.dec, -1);
        }
        if (e.target.id === "cartBtn") openDrawer();
        if (e.target.id === "closeDrawer") closeDrawer();

        const footLink = e.target.closest(".foot-link");
        if (footLink && footLink.dataset.cat) {
          state.cat = footLink.dataset.cat;
          document.getElementById("cat").value = state.cat;
          renderProdutos();
          window.scrollTo({
            top: document.getElementById("produtos").offsetTop - 80,
            behavior: "smooth",
          });
        }

        const tog = e.target.closest("[data-toggle-sold]");
        if (tog) {
          const id = tog.dataset.toggleSold;
          const prod = state.products.find((p) => p.id === id);
          if (!prod) return;
          if (prod.active === false) restoreProduct(id);
          else markSold(id);
        }
        const del = e.target.closest("[data-delete]");
        if (del) {
          const id = del.dataset.delete;
          if (confirm("Delete this product?")) removeProduct(id);
        }
      });

      document.getElementById("q").addEventListener("input", (e) => {
        state.q = e.target.value.toLowerCase();
        renderProdutos();
      });
      document.getElementById("cat").addEventListener("change", (e) => {
        state.cat = e.target.value;
        renderProdutos();
      });
      document.getElementById("maxPrice").addEventListener("input", (e) => {
        state.maxPrice = Number(e.target.value);
        document.getElementById("maxPriceValue").textContent = e.target.value;
        renderProdutos();
      });
      document.getElementById("newsForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const msg = document.getElementById("newsMsg");
        msg.textContent = "Thanks! You're on the list.";
        setTimeout(() => (msg.textContent = ""), 3000);
        e.target.reset();
      });
      document.getElementById("themeBtn").addEventListener("click", () => {
        state.theme = state.theme === "dark" ? "light" : "dark";
        applyTheme();
      });
      document.getElementById("checkout").addEventListener("click", () => {
        if (state.cart.length === 0) return alert("Your cart is empty.");
        alert("Checkout simulation â€” connect your payment gateway here.");
      });
      const restoreAllBtn = document.getElementById("restoreAll");
      if (restoreAllBtn) {
        restoreAllBtn.addEventListener("click", () => {
          Promise.all(
            (state.products || [])
              .filter((p) => p.active === false)
              .map((p) => restoreProduct(p.id))
          );
        });
      }

      // ================= Init =================
      document.getElementById("year").textContent = new Date().getFullYear();
      applyTheme();
      renderProdutos();
      renderCart();
      route();
    </script>
  </body>
</html>
